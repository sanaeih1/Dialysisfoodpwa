<!doctype html>
<html lang="fa" dir="rtl"> 
 <head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>مدیریت تغذیه بیماران دیالیزی</title> 
  <link href="https://cdn.jsdelivr.net/npm/vazir-font@28.0.0/dist/font-face.css" rel="stylesheet"> 
  <script src="https://cdn.jsdelivr.net/npm/persian-date@1.1.0/dist/persian-date.min.js"></script> 
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"> 
  <link rel="manifest" href="/manifest.json"> 
  <meta name="theme-color" content="#6a1b9a"> 
  <meta name="mobile-web-app-capable" content="yes"> 
  <meta name="apple-mobile-web-app-capable" content="yes"> 
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"> 
  <meta name="apple-mobile-web-app-title" content="تغذیه دیالیزی"> 
  <link rel="apple-touch-icon" href="icon-192x192.png"> 
  <style>
    body {
      font-family: 'Vazir', sans-serif;
      margin: 0;
      padding: 8px;
      background-color: #FFF5E1;
      direction: rtl;
      text-align: right;
      color: #222;
      overflow-x: hidden;
    }

    .container {
      max-width: 100%;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
    }

    h1 {
      font-size: 1.8rem;
      text-align: center;
      margin: 15px 0;
      font-weight: 500;
    }

    .intro-page {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background-color: #f0e7ff;
      padding: 20px;
      text-align: center;
    }

    .intro-page h1 {
      font-size: 2rem;
      color: #6a1b9a;
      margin-bottom: 20px;
    }

    .intro-page h2 {
      font-size: 1.6rem;
      color: #6a1b9a;
      margin-bottom: 20px;
    }

    .intro-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    .intro-tab-button {
      color: white;
      padding: 15px 25px;
      border-radius: 10px;
      font-size: 1.4rem;
      cursor: pointer;
      transition: background-color 0.3s;
      min-width: 180px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .intro-tab-button.dashboard { background-color: #2196f3; }
    .intro-tab-button.intakeHistory { background-color: #ff9800; }
    .intro-tab-button.foodList { background-color: #e91e63; }
    .intro-tab-button.videos { background-color: #9c27b0; }
    .intro-tab-button.settings { background-color: #607d8b; }
    .intro-tab-button.contact { background-color: #f44336; }
    .intro-tab-button.about { background-color: #ff5722; }
    .intro-tab-button.tutorial { background-color: #4caf50; }

    .intro-tab-button:hover {
      filter: brightness(1.1);
    }

    .content-area {
      display: none;
      flex-grow: 1;
      margin-top: 20px;
      padding-bottom: 15px;
    }

    .content-area.active {
      display: block;
    }

    .nav-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-bottom: 15px;
    }

    .nav-button {
      background-color: #7e57c2;
      color: white;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .nav-button:hover {
      background-color: #9575cd;
    }

    .tab-content {
      display: none;
      background-color: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
      margin: 8px;
    }

    .tab-content.active {
      display: block;
    }

    h2, h3 {
      color: #222;
      margin-bottom: 12px;
      font-size: 1.4rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    p {
      line-height: 1.6;
      color: #333;
      font-size: 1.2rem;
      margin-bottom: 8px;
    }

    small {
      color: #666;
      font-size: 0.9rem;
      display: block;
      margin-top: 4px;
    }

    .table-wrapper {
      overflow-x: auto;
      margin-top: 8px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 500px;
      background-color: white;
    }

    table, th, td {
      border: 1px solid #e0e0e0;
    }

    th, td {
      padding: 10px;
      text-align: center;
      font-size: 1rem;
    }

    th {
      background-color: #f5f5f5;
      font-weight: 500;
    }

    tr:nth-child(even) {
      background-color: #fafafa;
    }

    button {
      padding: 10px 20px;
      margin: 6px 0;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.1rem;
      width: 100%;
      max-width: 180px;
      transition: background-color 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .add-button, .edit-button, .contact-button {
      background-color: #66bb6a;
      color: white;
    }

    .add-button:hover, .edit-button:hover, .contact-button:hover {
      background-color: #81c784;
    }

    .delete-button, .delete-all-button, .delete-all-data-button {
      background-color: #ef5350;
      color: white;
    }

    .delete-button:hover, .delete-all-button:hover, .delete-all-data-button:hover {
      background-color: #f44336;
    }

    .save-button {
      background-color: #42a5f5;
      color: white;
    }

    .save-button:hover {
      background-color: #2196f3;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: 100%;
      max-width: 350px;
      margin: 0 auto;
      background-color: #fafafa;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    input, select {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1.1rem;
      width: 100%;
      box-sizing: border-box;
    }

    input[type="number"] {
      -moz-appearance: textfield;
    }

    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    label {
      font-size: 1.1rem;
      color: #333;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .scrollable {
      overflow-x: auto;
      white-space: nowrap;
      padding: 8px 0;
      background-color: #fafafa;
      border-radius: 8px;
    }

    .scrollable p {
      display: inline-block;
      margin-right: 15px;
      font-size: 1.1rem;
      color: #333;
    }

    .charts-container {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
    }

    .chart-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      max-width: 220px;
      height: 280px;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      padding: 8px;
    }

    .chart-wrapper canvas {
      max-width: 100%;
    }

    .chart-wrapper span {
      font-size: 1.8rem;
      margin-top: 8px;
    }

    #warnings {
      margin: 15px 0;
    }

    .warning {
      background-color: #ffcccb;
      color: #d32f2f;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 8px;
      text-align: center;
      font-size: 1.1rem;
    }

    .error-message {
      background-color: #ffcccb;
      color: #d32f2f;
      padding: 10px;
      border-radius: 8px;
      margin: 8px 0;
      text-align: center;
      font-size: 1.1rem;
    }

    .accordion-button {
      background-color: #f5f5f5;
      color: #222;
      cursor: pointer;
      padding: 12px;
      width: 100%;
      text-align: right;
      border: none;
      outline: none;
      transition: background-color 0.3s;
      font-size: 1.2rem;
      border-radius: 8px;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .accordion-button:hover {
      background-color: #e0e0e0;
    }

    .accordion-content {
      padding: 0 12px;
      background-color: #fafafa;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
      border-radius: 8px;
    }

    .accordion-content.active {
      max-height: 450px;
      padding: 12px;
    }

    .video-container {
      margin: 15px 0;
      background-color: white;
      padding: 12px;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .video-container iframe {
      max-width: 100%;
      border-radius: 8px;
      height: 180px;
    }

    .food-image {
      width: 50px;
      height: 50px;
      object-fit: cover;
      border-radius: 5px;
    }

    .about-logo {
      max-width: 150px;
      margin: 15px auto;
      display: block;
    }

    @media (max-width: 768px) {
      body {
        padding: 5px;
      }

      h1 {
        font-size: 1.6rem;
      }

      .intro-page h1 {
        font-size: 1.8rem;
      }

      .intro-tab-button, .nav-button {
        font-size: 1.2rem;
        padding: 12px 20px;
        min-width: 160px;
      }

      table {
        font-size: 0.9rem;
        min-width: 450px;
      }

      th, td {
        padding: 8px;
      }

      button {
        padding: 8px 16px;
        font-size: 1rem;
        max-width: 160px;
      }

      input, select {
        font-size: 1rem;
        padding: 8px;
      }

      form {
        max-width: 320px;
        padding: 12px;
      }

      h2, h3 {
        font-size: 1.3rem;
      }

      p, label {
        font-size: 1rem;
      }

      .chart-wrapper {
        max-width: 200px;
        height: 260px;
      }

      .chart-wrapper span {
        font-size: 1.6rem;
      }

      .scrollable p {
        font-size: 1rem;
      }

      .video-container iframe {
        height: 160px;
      }

      .about-logo {
        max-width: 120px;
      }
    }

    @media (max-width: 480px) {
      h1 {
        font-size: 1.4rem;
      }

      .intro-page h1 {
        font-size: 1.6rem;
      }

      .intro-tab-button, .nav-button {
        font-size: 1.1rem;
        padding: 10px 15px;
        min-width: 140px;
      }

      table {
        font-size: 0.8rem;
        min-width: 400px;
      }

      th, td {
        padding: 6px;
      }

      button {
        padding: 6px 12px;
        font-size: 0.9rem;
        max-width: 140px;
      }

      input, select {
        font-size: 0.9rem;
        padding: 6px;
      }

      form {
        max-width: 280px;
        padding: 10px;
      }

      h2, h3 {
        font-size: 1.2rem;
      }

      p, label {
        font-size: 0.9rem;
      }

      .chart-wrapper {
        max-width: 180px;
        height: 240px;
      }

      .chart-wrapper span {
        font-size: 1.4rem;
      }

      .scrollable p {
        font-size: 0.9rem;
      }

      .video-container iframe {
        height: 140px;
      }

      .about-logo {
        max-width: 100px;
      }
    }
  </style> 
 </head> 
 <body> 
  <div class="intro-page" id="introPage"> 
   <h1>اپلیکیشن مدیریت تغذیه در دیالیز</h1> 
   <h2>درباره ما</h2> 
   <p>این اپلیکیشن برای کمک به بیماران دیالیزی طراحی شده است تا بتوانند تغذیه خود را به صورت دقیق مدیریت کنند. با استفاده از این برنامه می‌توانید مصرف مواد غذایی، آب، و ادرار خود را ثبت کنید، فیلم‌های آموزشی را مشاهده کنید و با تیم درمانی خود در ارتباط باشید.</p> 
   <div class="intro-tabs"> <button class="intro-tab-button dashboard" onclick="openTab('dashboard')"><i class="fas fa-home"></i> مقادیر مواد غذایی</button> <button class="intro-tab-button intakeHistory" onclick="openTab('intakeHistory')"><i class="fas fa-history"></i> تاریخچه مصرف مواد غذایی شما</button> <button class="intro-tab-button foodList" onclick="openTab('foodList')"><i class="fas fa-utensils"></i> لیست مواد غذایی</button> <button class="intro-tab-button videos" onclick="openTab('videos')"><i class="fas fa-video"></i> فیلم‌های آموزشی</button> <button class="intro-tab-button tutorial" onclick="openTab('tutorial')"><i class="fas fa-book"></i> آموزش استفاده از اپلیکیشن</button> <button class="intro-tab-button settings" onclick="openTab('settings')"><i class="fas fa-cog"></i> تنظیمات</button> <button class="intro-tab-button contact" onclick="openTab('contact')"><i class="fas fa-phone"></i> ارتباط با تیم درمانی</button> <button class="intro-tab-button about" onclick="openTab('about')"><i class="fas fa-info-circle"></i> درباره ما</button> 
   </div> 
  </div> 
  <div class="container"> 
   <div class="content-area" id="contentArea"> 
    <div class="nav-buttons"> <button class="nav-button" onclick="goBack()"><i class="fas fa-arrow-right"></i> برگشت</button> 
    </div> 
    <h1>مدیریت تغذیه بیماران دیالیزی</h1> 
    <div id="errorMessage" class="error-message" style="display: none;"></div> 
    <section id="dashboard" class="tab-content"> 
     <h2><i class="fas fa-home"></i> مقادیر مواد غذایی</h2> <button class="delete-all-data-button" onclick="resetAllData()"><i class="fas fa-trash-alt"></i> پاک کردن تمام داده‌ها</button> 
     <div class="charts-container"> 
      <div class="chart-wrapper"> 
       <canvas id="sodiumChart"></canvas> <span id="sodiumSticker">😊</span> 
      </div> 
      <div class="chart-wrapper"> 
       <canvas id="potassiumChart"></canvas> <span id="potassiumSticker">😊</span> 
      </div> 
      <div class="chart-wrapper"> 
       <canvas id="phosphorusChart"></canvas> <span id="phosphorusSticker">😊</span> 
      </div> 
      <div class="chart-wrapper"> 
       <canvas id="proteinChart"></canvas> <span id="proteinSticker">😊</span> 
      </div> 
      <div class="chart-wrapper"> 
       <canvas id="waterChart"></canvas> <span id="waterSticker">😊</span> 
      </div> 
     </div> 
     <div id="warnings"></div> 
     <div id="currentTotals" class="scrollable"> 
      <p>سدیم مصرفی: <span id="totalSodiumMg">0</span> گرم (حد مجاز: <span id="sodiumLimitDisplayMg"></span> گرم)</p> 
      <p>پتاسیم مصرفی: <span id="totalPotassiumMg">0</span> گرم (حد مجاز: <span id="potassiumLimitDisplayMg"></span> گرم)</p> 
      <p>فسفر مصرفی: <span id="totalPhosphorusMg">0</span> گرم (حد مجاز: <span id="phosphorusLimitDisplayMg"></span> گرم)</p> 
      <p>پروتئین مصرفی: <span id="totalProteinMg">0</span> گرم (حد مجاز: <span id="proteinLimitDisplayMg"></span> گرم)</p> 
      <p>آب مصرفی: <span id="totalWaterMl">0</span> میلی‌لیتر (حد مجاز: <span id="waterLimitDisplayMl"></span> میلی‌لیتر)</p> 
      <p>کالری مصرفی: <span id="totalKcal">0</span> کیلوکالری</p> 
      <p>مقدار ادرار ۲۴ ساعته: <span id="dailyUrineOutput">0</span> میلی‌لیتر</p> 
     </div> 
     <h3><i class="fas fa-utensils"></i> ثبت مصرف غذا</h3> 
     <form id="foodIntakeForm" onsubmit="addIntake(event)"> <label for="foodSelect"><i class="fas fa-list"></i> انتخاب غذا:</label> <select id="foodSelect" name="foodSelect" required> <option value="">یک غذا انتخاب کنید</option> </select> <label for="quantity"><i class="fas fa-weight"></i> مقدار (گرم):</label> 
      <input type="number" id="quantity" name="quantity" step="0.01" required> <label for="mealType"><i class="fas fa-clock"></i> وعده غذایی:</label> <select id="mealType" name="mealType" required> <option value="صبحانه">صبحانه</option> <option value="ناهار">ناهار</option> <option value="شام">شام</option> <option value="میان‌وعده">میان‌وعده</option> </select> <button type="submit" class="add-button"><i class="fas fa-plus"></i> اضافه کردن</button> 
     </form> 
     <h3><i class="fas fa-glass-whiskey"></i> ثبت مصرف آب (لیوان ۲۰۰ سی‌سی)</h3> 
     <form id="waterIntakeForm" onsubmit="addWaterIntake(event)"> <label for="waterCups"><i class="fas fa-tint"></i> تعداد لیوان‌ها:</label> 
      <input type="number" id="waterCups" name="waterCups" step="0.01" required> <button type="submit" class="add-button"><i class="fas fa-plus"></i> اضافه کردن</button> 
     </form> 
     <h3><i class="fas fa-tint-slash"></i> ثبت مقدار ادرار (میلی‌لیتر)</h3> 
     <form id="urineIntakeForm" onsubmit="addUrineOutput(event)"> <label for="urineAmount"><i class="fas fa-tint"></i> مقدار ادرار (میلی‌لیتر):</label> 
      <input type="number" id="urineAmount" name="urineAmount" step="0.01" required> <button type="submit" class="add-button"><i class="fas fa-plus"></i> ثبت</button> 
     </form> 
     <h3><i class="fas fa-chart-pie"></i> مشاهده مقادیر غذایی</h3> 
     <form id="foodNutrientForm" onsubmit="displayFoodNutrients(event)"> <label for="foodNutrientSelect"><i class="fas fa-list"></i> انتخاب غذا:</label> <select id="foodNutrientSelect" name="foodNutrientSelect" required> <option value="">یک غذا انتخاب کنید</option> </select> <button type="submit" class="add-button"><i class="fas fa-eye"></i> نمایش مقادیر</button> 
     </form> 
     <div class="charts-container" id="foodNutrientCharts"></div> 
    </section> 
    <section id="intakeHistory" class="tab-content"> 
     <h2><i class="fas fa-history"></i> تاریخچه مصرف مواد غذایی شما</h2> <button class="delete-all-button" onclick="deleteAllIntakes()"><i class="fas fa-trash"></i> حذف همه</button> 
     <div class="table-wrapper"> 
      <table> 
       <thead> 
        <tr> 
         <th>تاریخ</th> 
         <th>نوع</th> 
         <th>غذا/آب/ادرار</th> 
         <th>مقدار</th> 
         <th>سدیم (گرم)</th> 
         <th>پتاسیم (گرم)</th> 
         <th>فسفر (گرم)</th> 
         <th>پروتئین (گرم)</th> 
         <th>آب (میلی‌لیتر)</th> 
         <th>ادرار (میلی‌لیتر)</th> 
         <th>کالری (kcal)</th> 
         <th>عملیات</th> 
        </tr> 
       </thead> 
       <tbody id="intakeTableBody"></tbody> 
      </table> 
     </div> 
    </section> 
    <section id="foodList" class="tab-content"> 
     <h2><i class="fas fa-utensils"></i> لیست مواد غذایی</h2> 
     <div> <label for="filterSelect"><i class="fas fa-filter"></i> فیلتر بر اساس:</label> <select id="filterSelect" onchange="filterFoodDatabase()"> <option value="all">همه</option> <option value="lowPotassium">کم‌پتاسیم</option> <option value="lowPhosphorus">کم‌فسفر</option> <option value="lowSodium">کم‌سدیم</option> </select> 
     </div> 
     <div id="foodCategories"></div> <button class="add-button" onclick="showAddFoodForm()"><i class="fas fa-plus"></i> اضافه کردن غذا</button> 
     <form id="addFoodForm" style="display: none;" onsubmit="addFood(event)"> 
      <h3><i class="fas fa-utensils"></i> اضافه کردن/ویرایش غذا</h3> 
      <input type="hidden" id="foodIndex" name="foodIndex"> <label for="foodName"><i class="fas fa-tag"></i> نام غذا:</label> 
      <input type="text" id="foodName" name="foodName" required> <label for="foodCategory"><i class="fas fa-list-alt"></i> دسته‌بندی:</label> <select id="foodCategory" name="foodCategory" required> <option value="گوشت">گوشت</option> <option value="سبزیجات">سبزیجات</option> <option value="لبنیات">لبنیات</option> <option value="غلات">غلات</option> <option value="میوه‌ها">میوه‌ها</option> </select> <label for="foodImage"><i class="fas fa-image"></i> تصویر غذا:</label> 
      <input type="file" id="foodImage" name="foodImage" accept="image/*"> <label for="foodSodium"><i class="fas fa-flask"></i> سدیم (گرم):</label> 
      <input type="number" id="foodSodium" name="foodSodium" step="0.001" required> <label for="foodPotassium"><i class="fas fa-flask"></i> پتاسیم (گرم):</label> 
      <input type="number" id="foodPotassium" name="foodPotassium" step="0.001" required> <label for="foodPhosphorus"><i class="fas fa-flask"></i> فسفر (گرم):</label> 
      <input type="number" id="foodPhosphorus" name="foodPhosphorus" step="0.001" required> <label for="foodProtein"><i class="fas fa-drumstick-bite"></i> پروتئین (گرم):</label> 
      <input type="number" id="foodProtein" name="foodProtein" step="0.01" required> <label for="foodWater"><i class="fas fa-tint"></i> آب (میلی‌لیتر):</label> 
      <input type="number" id="foodWater" name="foodWater" step="0.01" required> <label for="foodKcal"><i class="fas fa-fire"></i> کالری (kcal):</label> 
      <input type="number" id="foodKcal" name="foodKcal" step="0.01" required> <label for="foodCarb"><i class="fas fa-bread-slice"></i> کربوهیدرات (گرم):</label> 
      <input type="number" id="foodCarb" name="foodCarb" step="0.01" required> <label for="foodFat"><i class="fas fa-cheese"></i> چربی (گرم):</label> 
      <input type="number" id="foodFat" name="foodFat" step="0.01" required> <button type="submit" class="save-button"><i class="fas fa-save"></i> ذخیره</button> 
     </form> 
    </section> 
    <section id="videos" class="tab-content"> 
     <h2><i class="fas fa-video"></i> فیلم‌های آموزشی</h2> 
     <div class="video-container"> 
      <h3>رژیم خاص</h3> <iframe src="https://www.aparat.com/video/video/embed/videohash/vhf4z5z/vt/frame" allowfullscreen="true" width="100%" height="180"></iframe> 
     </div> 
     <div class="video-container"> 
      <h3>فسفر</h3> <iframe src="https://www.aparat.com/video/video/embed/videohash/hlqzdki/vt/frame" allowfullscreen="true" width="100%" height="180"></iframe> 
     </div> 
     <div class="video-container"> 
      <h3>پتاسیم</h3> <iframe src="https://www.aparat.com/video/video/embed/videohash/ifu44gz/vt/frame" allowfullscreen="true" width="100%" height="180"></iframe> 
     </div> 
     <div class="video-container"> 
      <h3>سدیم و آب</h3> <iframe src="https://www.aparat.com/video/video/embed/videohash/lof5k6h/vt/frame" allowfullscreen="true" width="100%" height="180"></iframe> 
     </div> 
     <div class="video-container"> 
      <h3>قند و انرژی</h3> <iframe src="https://www.aparat.com/video/video/embed/videohash/hjc3195/vt/frame" allowfullscreen="true" width="100%" height="180"></iframe> 
     </div> 
    </section> 
    <section id="tutorial" class="tab-content"> 
     <h2><i class="fas fa-book"></i> آموزش استفاده از اپلیکیشن</h2> 
     <div class="video-container"> 
      <h3>راهنمای استفاده از اپلیکیشن تغذیه دیالیزی</h3> <iframe src="https://www.aparat.com/video/video/embed/videohash/TUTORIAL123/vt/frame" allowfullscreen="true" width="100%" height="180"></iframe> 
     </div> 
    </section> 
    <section id="settings" class="tab-content"> 
     <h2><i class="fas fa-cog"></i> تنظیمات</h2> 
     <form id="settingsForm" onsubmit="saveSettings(event)"> <label for="ibw"><i class="fas fa-weight"></i> وزن ایده‌آل بدن (IBW) (کیلوگرم):</label> <small>وزن ایده‌آل بیمار (کیلوگرم) را وارد کنید تا حدود مواد مغذی محاسبه شود.</small> <small>فرمول‌ها بر اساس وزن ایده‌آل تنظیم می‌شوند.</small> 
      <input type="number" id="ibw" name="ibw" step="0.01" placeholder="وزن ایده‌آل خود را وارد کنید" required> <label for="urineOutput"><i class="fas fa-tint"></i> حجم ادرار روزانه (میلی‌لیتر):</label> <small>حجم ادرار روزانه بیمار (میلی‌لیتر) را وارد کنید.</small> 
      <input type="number" id="urineOutput" name="urineOutput" step="0.01" placeholder="حجم ادرار روزانه"> <label for="minimumUrineOutput"><i class="fas fa-tint-slash"></i> حداقل مقدار ادرار مجاز (میلی‌لیتر):</label> <small>حداقل ادرار مجاز (میلی‌لیتر) را وارد کنید تا هشدار نمایش داده شود.</small> 
      <input type="number" id="minimumUrineOutput" name="minimumUrineOutput" step="0.01" placeholder="حداقل مقدار ادرار" required> <label for="sodiumLimit"><i class="fas fa-flask"></i> حد سدیم (گرم):</label> <small>حد مجاز سدیم (گرم). فرمول: 2.3 × (IBW / 70) گرم</small> 
      <input type="number" id="sodiumLimit" name="sodiumLimit" step="0.001" readonly> <label for="potassiumLimit"><i class="fas fa-flask"></i> حد پتاسیم (گرم):</label> <small>حد مجاز پتاسیم (گرم). فرمول: 2.5 × (IBW / 70) گرم</small> 
      <input type="number" id="potassiumLimit" name="potassiumLimit" step="0.001" readonly> <label for="phosphorusLimit"><i class="fas fa-flask"></i> حد فسفر (گرم):</label> <small>حد مجاز فسفر (گرم). فرمول: 0.9 × (IBW / 70) گرم</small> 
      <input type="number" id="phosphorusLimit" name="phosphorusLimit" step="0.001" readonly> <label for="proteinLimit"><i class="fas fa-drumstick-bite"></i> حد پروتئین (گرم):</label> <small>حد مجاز پروتئین (گرم). فرمول: 1.2 × IBW گرم</small> 
      <input type="number" id="proteinLimit" name="proteinLimit" step="0.01" readonly> <label for="waterLimit"><i class="fas fa-tint"></i> حد آب (میلی‌لیتر):</label> <small>حد مجاز آب (میلی‌لیتر). فرمول: 1000 + ادرار روزانه + (50 × IBW) میلی‌لیتر</small> 
      <input type="number" id="waterLimit" name="waterLimit" step="0.01" readonly> <label for="fontSize"><i class="fas fa-font"></i> اندازه فونت:</label> <small>اندازه فونت متن را برای خوانایی بهتر انتخاب کنید.</small> <select id="fontSize" name="fontSize"> <option value="small">کوچک</option> <option value="medium">متوسط</option> <option value="large" selected>بزرگ</option> </select> <button type="submit" class="save-button"><i class="fas fa-save"></i> ذخیره</button> 
     </form> 
    </section> 
    <section id="contact" class="tab-content"> 
     <h2><i class="fas fa-phone"></i> ارتباط با تیم درمانی</h2> 
     <p>برای ارتباط با تیم درمانی و مطرح کردن سوالات خود، روی دکمه زیر کلیک کنید:</p> <button class="contact-button" onclick="sendSMS()"><i class="fas fa-sms"></i> ارسال پیامک به تیم درمانی</button> 
    </section> 
    <section id="about" class="tab-content"> 
     <h2><i class="fas fa-info-circle"></i> درباره ما</h2> 
     <img src="https://www.mums.ac.ir/images/mums.ac.ir/logo.png" alt="لوگو دانشگاه علوم پزشکی مشهد" class="about-logo"> 
     <p>این اپلیکیشن توسط تیم تحقیقاتی دانشگاه علوم پزشکی مشهد توسعه یافته است. تیم ما متشکل از متخصصان تغذیه، پزشکان نفرولوژی و مهندسان نرم‌افزار است که با هدف بهبود کیفیت زندگی بیماران دیالیزی فعالیت می‌کنند. اپلیکیشن تغذیه دیالیزی به بیماران کمک می‌کند تا رژیم غذایی خود را به دقت مدیریت کرده و با ثبت مصرف مواد غذایی، آب و ادرار، سلامت خود را بهتر کنترل کنند.</p> 
     <p>ما در تلاش هستیم تا با ارائه ابزارهای کاربردی و آموزش‌های به‌روز، بیماران دیالیزی را در مسیر مدیریت بهتر بیماری خود یاری کنیم. برای اطلاعات بیشتر با تیم درمانی ما تماس بگیرید.</p> 
    </section> 
   </div> 
  </div> 
  <script>
    let pageHistory = [];

    function generateDeviceId() {
      const userAgent = navigator.userAgent;
      const randomString = Math.random().toString(36).substring(2, 15);
      return btoa(userAgent + randomString).substring(0, 20);
    }

    const deviceId = localStorage.getItem('deviceId') || generateDeviceId();
    localStorage.setItem('deviceId', deviceId);

    const storageKey = `dialysisAppData_${deviceId}`;
    let userData = {};
    try {
      userData = JSON.parse(localStorage.getItem(storageKey)) || {};
    } catch (e) {
      console.error('Error loading data from localStorage:', e);
      userData = {};
    }

    userData = {
      intakeHistory: userData.intakeHistory || [],
      foodDB: userData.foodDB || [
        {
          name: 'مرغ (سینه بدون پوست)',
          category: 'گوشت',
          sodium: 0.07,
          potassium: 0.28,
          phosphorus: 0.2,
          protein: 25,
          water: 65,
          carb: 0,
          fat: 3.6,
          kcal: 165,
          bloodSugarImpact: 'کم',
          restrictions: { phosphorus: 'high', potassium: 'moderate' },
          image: ''
        },
        {
          name: 'گوشت گاو (لخم)',
          category: 'گوشت',
          sodium: 0.06,
          potassium: 0.35,
          phosphorus: 0.22,
          protein: 26,
          water: 60,
          carb: 0,
          fat: 10,
          kcal: 200,
          bloodSugarImpact: 'کم',
          restrictions: { phosphorus: 'high', potassium: 'high' },
          image: ''
        },
        {
          name: 'خیار',
          category: 'سبزیجات',
          sodium: 0.002,
          potassium: 0.147,
          phosphorus: 0.024,
          protein: 0.7,
          water: 95,
          carb: 3.6,
          fat: 0.1,
          kcal: 16,
          bloodSugarImpact: 'کم',
          restrictions: { potassium: 'low' },
          image: ''
        },
        {
          name: 'کاهو',
          category: 'سبزیجات',
          sodium: 0.01,
          potassium: 0.194,
          phosphorus: 0.02,
          protein: 1.4,
          water: 94,
          carb: 2.9,
          fat: 0.2,
          kcal: 15,
          bloodSugarImpact: 'کم',
          restrictions: { potassium: 'low' },
          image: ''
        },
        {
          name: 'ماست کم‌چرب',
          category: 'لبنیات',
          sodium: 0.05,
          potassium: 0.255,
          phosphorus: 0.135,
          protein: 5.7,
          water: 85,
          carb: 7.7,
          fat: 1.1,
          kcal: 61,
          bloodSugarImpact: 'متوسط',
          restrictions: { phosphorus: 'moderate' },
          image: ''
        },
        {
          name: 'برنج سفید پخته',
          category: 'غلات',
          sodium: 0.001,
          potassium: 0.035,
          phosphorus: 0.043,
          protein: 2.7,
          water: 68,
          carb: 28,
          fat: 0.3,
          kcal: 130,
          bloodSugarImpact: 'بالا',
          restrictions: { potassium: 'low' },
          image: ''
        },
        {
          name: 'سیب',
          category: 'میوه‌ها',
          sodium: 0.001,
          potassium: 0.107,
          phosphorus: 0.011,
          protein: 0.3,
          water: 85,
          carb: 14,
          fat: 0.2,
          kcal: 52,
          bloodSugarImpact: 'متوسط',
          restrictions: { potassium: 'low' },
          image: ''
        }
      ],
      limits: userData.limits || {
        sodium: 2.3,
        potassium: 2.5,
        phosphorus: 0.9,
        protein: 80,
        water: 1000
      },
      ibw: userData.ibw || null,
      urineOutput: userData.urineOutput || null,
      minimumUrineOutput: userData.minimumUrineOutput || 500,
      fontSize: userData.fontSize || 'large'
    };

    let intakeHistory = userData.intakeHistory;
    let foodDB = userData.foodDB;
    let limits = userData.limits;
    let charts = {};
    let nutrientCharts = {};

    window.onload = function() {
      applySettings();
      populateFoodSelect();
      populateFoodNutrientSelect();
      displayIntakeHistory();
      displayFoodDatabase();
      displayLimits();
      updateDashboard();
    };

    function applySettings() {
      applyFontSize(userData.fontSize);
    }

    function showError(message) {
      const errorDiv = document.getElementById('errorMessage');
      errorDiv.textContent = message;
      errorDiv.style.display = 'block';
      setTimeout(() => {
        errorDiv.style.display = 'none';
      }, 5000);
    }

    function applyFontSize(size) {
      let fontSize;
      switch (size) {
        case 'small': fontSize = '0.9rem'; break;
        case 'medium': fontSize = '1rem'; break;
        case 'large': fontSize = '1.2rem'; break;
        default: fontSize = '1.2rem';
      }
      document.documentElement.style.fontSize = fontSize;
      userData.fontSize = size;
      saveData();
    }

    function saveData() {
      try {
        userData.intakeHistory = intakeHistory;
        userData.foodDB = foodDB;
        userData.limits = limits;
        userData.ibw = parseFloat(document.getElementById('ibw').value) || null;
        userData.urineOutput = parseFloat(document.getElementById('urineOutput').value) || null;
        userData.minimumUrineOutput = parseFloat(document.getElementById('minimumUrineOutput').value) || 500;
        userData.fontSize = document.getElementById('fontSize').value || 'large';
        localStorage.setItem(storageKey, JSON.stringify(userData));
      } catch (e) {
        showError('خطا در ذخیره‌سازی داده‌ها. لطفاً دوباره تلاش کنید.');
        console.error('Error saving data to localStorage:', e);
      }
    }

    function openTab(tabName) {
      document.getElementById('introPage').style.display = 'none';
      document.getElementById('contentArea').style.display = 'block';
      const tabContents = document.getElementsByClassName('tab-content');
      for (let i = 0; i < tabContents.length; i++) {
        tabContents[i].classList.remove('active');
      }
      document.getElementById(tabName).classList.add('active');
      pageHistory.push(tabName);
      if (tabName === 'dashboard') {
        populateFoodNutrientSelect();
      }
    }

    function goBack() {
      if (pageHistory.length > 1) {
        pageHistory.pop();
        const previousPage = pageHistory[pageHistory.length - 1];
        openTab(previousPage);
      } else {
        document.getElementById('introPage').style.display = 'block';
        document.getElementById('contentArea').style.display = 'none';
        const tabContents = document.getElementsByClassName('tab-content');
        for (let i = 0; i < tabContents.length; i++) {
          tabContents[i].classList.remove('active');
        }
        pageHistory = [];
      }
    }

    function resetAllData() {
      if (confirm('آیا مطمئن هستید که می‌خواهید تمام داده‌ها (شامل تاریخچه، مواد غذایی و تنظیمات) را پاک کنید؟ این عملیات قابل بازگشت نیست.')) {
        intakeHistory = [];
        foodDB = [
          {
            name: 'مرغ (سینه بدون پوست)',
            category: 'گوشت',
            sodium: 0.07,
            potassium: 0.28,
            phosphorus: 0.2,
            protein: 25,
            water: 65,
            carb: 0,
            fat: 3.6,
            kcal: 165,
            bloodSugarImpact: 'کم',
            restrictions: { phosphorus: 'high', potassium: 'moderate' },
            image: ''
          },
          {
            name: 'گوشت گاو (لخم)',
            category: 'گوشت',
            sodium: 0.06,
            potassium: 0.35,
            phosphorus: 0.22,
            protein: 26,
            water: 60,
            carb: 0,
            fat: 10,
            kcal: 200,
            bloodSugarImpact: 'کم',
            restrictions: { phosphorus: 'high', potassium: 'high' },
            image: ''
          },
          {
            name: 'خیار',
            category: 'سبزیجات',
            sodium: 0.002,
            potassium: 0.147,
            phosphorus: 0.024,
            protein: 0.7,
            water: 95,
            carb: 3.6,
            fat: 0.1,
            kcal: 16,
            bloodSugarImpact: 'کم',
            restrictions: { potassium: 'low' },
            image: ''
          },
          {
            name: 'کاهو',
            category: 'سبزیجات',
            sodium: 0.01,
            potassium: 0.194,
            phosphorus: 0.02,
            protein: 1.4,
            water: 94,
            carb: 2.9,
            fat: 0.2,
            kcal: 15,
            bloodSugarImpact: 'کم',
            restrictions: { potassium: 'low' },
            image: ''
          },
          {
            name: 'ماست کم‌چرب',
            category: 'لبنیات',
            sodium: 0.05,
            potassium: 0.255,
            phosphorus: 0.135,
            protein: 5.7,
            water: 85,
            carb: 7.7,
            fat: 1.1,
            kcal: 61,
            bloodSugarImpact: 'متوسط',
            restrictions: { phosphorus: 'moderate' },
            image: ''
          },
          {
            name: 'برنج سفید پخته',
            category: 'غلات',
            sodium: 0.001,
            potassium: 0.035,
            phosphorus: 0.043,
            protein: 2.7,
            water: 68,
            carb: 28,
            fat: 0.3,
            kcal: 130,
            bloodSugarImpact: 'بالا',
            restrictions: { potassium: 'low' },
            image: ''
          },
          {
            name: 'سیب',
            category: 'میوه‌ها',
            sodium: 0.001,
            potassium: 0.107,
            phosphorus: 0.011,
            protein: 0.3,
            water: 85,
            carb: 14,
            fat: 0.2,
            kcal: 52,
            bloodSugarImpact: 'متوسط',
            restrictions: { potassium: 'low' },
            image: ''
          }
        ];
        limits = { sodium: 2.3, potassium: 2.5, phosphorus: 0.9, protein: 80, water: 1000 };
        userData = {
          intakeHistory: [],
          foodDB: foodDB,
          limits: limits,
          ibw: null,
          urineOutput: null,
          minimumUrineOutput: 500,
          fontSize: 'large'
        };
        localStorage.setItem(storageKey, JSON.stringify(userData));
        populateFoodSelect();
        populateFoodNutrientSelect();
        displayIntakeHistory();
        displayFoodDatabase();
        displayLimits();
        updateDashboard();
        showError('تمام داده‌ها با موفقیت پاک شدند.');
      }
    }

    function setupAccordion() {
      const buttons = document.getElementsByClassName('accordion-button');
      for (let i = 0; i < buttons.length; i++) {
        buttons[i].addEventListener('click', function() {
          const content = this.nextElementSibling;
          content.classList.toggle('active');
        });
      }
    }

    function populateFoodSelect() {
      const foodSelect = document.getElementById('foodSelect');
      foodSelect.innerHTML = '<option value="">یک غذا انتخاب کنید</option>';
      foodDB.forEach((food, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.textContent = food.name;
        foodSelect.appendChild(option);
      });
    }

    function populateFoodNutrientSelect() {
      const foodSelect = document.getElementById('foodNutrientSelect');
      foodSelect.innerHTML = '<option value="">یک غذا انتخاب کنید</option>';
      foodDB.forEach((food, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.textContent = food.name;
        foodSelect.appendChild(option);
      });
    }

    function addIntake(event) {
      event.preventDefault();
      const foodSelect = document.getElementById('foodSelect');
      const quantityInput = document.getElementById('quantity');
      const mealTypeSelect = document.getElementById('mealType');

      const foodIndex = parseInt(foodSelect.value);
      const quantity = parseFloat(quantityInput.value);
      const mealType = mealTypeSelect.value;

      if (isNaN(foodIndex) || foodIndex < 0 || foodIndex >= foodDB.length) {
        showError('لطفاً یک غذا انتخاب کنید.');
        return;
      }
      if (isNaN(quantity) || quantity <= 0) {
        showError('لطفاً مقدار معتبری وارد کنید.');
        return;
      }
      if (!mealType) {
        showError('لطفاً یک وعده غذایی انتخاب کنید.');
        return;
      }

      const food = foodDB[foodIndex];
      let date;
      try {
        const persianDate = new persianDate();
        date = persianDate.format('dddd D MMMM YYYY');
      } catch (e) {
        console.error('Error with persianDate:', e);
        date = new Date().toLocaleDateString('fa-IR');
      }

      const timestamp = new Date().getTime();

      const intake = {
        type: 'food',
        date: date,
        timestamp: timestamp,
        mealType: mealType,
        food: food.name,
        quantity: quantity,
        sodium: parseFloat(((food.sodium || 0) * quantity / 100).toFixed(3)),
        potassium: parseFloat(((food.potassium || 0) * quantity / 100).toFixed(3)),
        phosphorus: parseFloat(((food.phosphorus || 0) * quantity / 100).toFixed(3)),
        protein: parseFloat(((food.protein || 0) * quantity / 100).toFixed(2)),
        water: parseFloat(((food.water || 0) * quantity / 100).toFixed(2)),
        urine: 0,
        kcal: parseFloat(((food.kcal || 0) * quantity / 100).toFixed(2))
      };

      intakeHistory.push(intake);
      saveData();
      displayIntakeHistory();
      updateDashboard();

      foodSelect.selectedIndex = 0;
      quantityInput.value = '';
      mealTypeSelect.selectedIndex = 0;
    }

    function addWaterIntake(event) {
      event.preventDefault();
      const waterCupsInput = document.getElementById('waterCups');
      const cups = parseFloat(waterCupsInput.value);

      if (isNaN(cups) || cups <= 0) {
        showError('لطفاً تعداد لیوان‌ها را به صورت معتبر وارد کنید.');
        return;
      }

      const waterAmount = parseFloat((cups * 200).toFixed(2));

      let date;
      try {
        const persianDate = new persianDate();
        date = persianDate.format('dddd D MMMM YYYY');
      } catch (e) {
        console.error('Error with persianDate:', e);
        date = new Date().toLocaleDateString('fa-IR');
      }

      const timestamp = new Date().getTime();

      const intake = {
        type: 'water',
        date: date,
        timestamp: timestamp,
        mealType: '-',
        food: `آب (${cups} لیوان)`,
        quantity: cups,
        sodium: 0,
        potassium: 0,
        phosphorus: 0,
        protein: 0,
        water: waterAmount,
        urine: 0,
        kcal: 0
      };

      intakeHistory.push(intake);
      saveData();
      displayIntakeHistory();
      updateDashboard();

      waterCupsInput.value = '';
    }

    function addUrineOutput(event) {
      event.preventDefault();
      const urineAmountInput = document.getElementById('urineAmount');
      const urineAmount = parseFloat(urineAmountInput.value);

      if (isNaN(urineAmount) || urineAmount <= 0) {
        showError('لطفاً مقدار معتبری برای ادرار وارد کنید.');
        return;
      }

      let date;
      try {
        const persianDate = new persianDate();
        date = persianDate.format('dddd D MMMM YYYY');
      } catch (e) {
        console.error('Error with persianDate:', e);
        date = new Date().toLocaleDateString('fa-IR');
      }

      const timestamp = new Date().getTime();

      const intake = {
        type: 'urine',
        date: date,
        timestamp: timestamp,
        mealType: '-',
        food: 'ادرار',
        quantity: parseFloat(urineAmount.toFixed(2)),
        sodium: 0,
        potassium: 0,
        phosphorus: 0,
        protein: 0,
        water: 0,
        urine: parseFloat(urineAmount.toFixed(2)),
        kcal: 0
      };

      intakeHistory.push(intake);
      saveData();
      displayIntakeHistory();
      updateDashboard();

      urineAmountInput.value = '';
    }

    function calculateDailyUrineOutput() {
      const now = new Date().getTime();
      const oneDayInMs = 24 * 60 * 60 * 1000;
      const recentUrine = intakeHistory.filter(item => {
        return item.type === 'urine' && (now - item.timestamp) <= oneDayInMs;
      });
      return parseFloat(recentUrine.reduce((sum, item) => sum + (item.urine || 0), 0).toFixed(2));
    }

    function displayIntakeHistory() {
      const intakeTableBody = document.getElementById('intakeTableBody');
      intakeTableBody.innerHTML = '';
      intakeHistory.forEach((intake, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${intake.date || '-'}</td>
          <td>${intake.type === 'food' ? intake.mealType : (intake.type === 'water' ? 'آب' : 'ادرار')}</td>
          <td>${intake.food || '-'}</td>
          <td>${intake.type === 'food' ? (intake.quantity || 0) + ' گرم' : (intake.type === 'water' ? intake.quantity + ' لیوان' : intake.quantity + ' میلی‌لیتر')}</td>
          <td>${(intake.sodium || 0).toFixed(3)}</td>
          <td>${(intake.potassium || 0).toFixed(3)}</td>
          <td>${(intake.phosphorus || 0).toFixed(3)}</td>
          <td>${(intake.protein || 0).toFixed(2)}</td>
          <td>${(intake.water || 0).toFixed(2)}</td>
          <td>${(intake.urine || 0).toFixed(2)}</td>
          <td>${(intake.kcal || 0).toFixed(2)}</td>
          <td>
            <button class="delete-button" onclick="deleteIntake(${index})"><i class="fas fa-trash"></i> حذف</button>
          </td>
        `;
        intakeTableBody.appendChild(row);
      });
    }

    function deleteIntake(index) {
      intakeHistory.splice(index, 1);
      saveData();
      displayIntakeHistory();
      updateDashboard();
    }

    function deleteAllIntakes() {
      if (confirm('آیا مطمئن هستید که می‌خواهید همه اطلاعات ثبت‌شده را حذف کنید؟')) {
        intakeHistory = [];
        saveData();
        displayIntakeHistory();
        updateDashboard();
      }
    }

    function filterFoodDatabase() {
      const filter = document.getElementById('filterSelect').value;
      let filteredFoods = foodDB;
      if (filter === 'lowPotassium') {
        filteredFoods = foodDB.filter(food => food.restrictions && (food.restrictions.potassium === 'low' || !food.restrictions.potassium));
      } else if (filter === 'lowPhosphorus') {
        filteredFoods = foodDB.filter(food => food.restrictions && (food.restrictions.phosphorus === 'low' || !food.restrictions.phosphorus));
      } else if (filter === 'lowSodium') {
        filteredFoods = foodDB.filter(food => food.restrictions && (food.restrictions.sodium === 'low' || !food.restrictions.sodium));
      }
      displayFoodDatabase(filteredFoods);
    }

    function displayFoodDatabase(foods = foodDB) {
      const foodCategoriesDiv = document.getElementById('foodCategories');
      foodCategoriesDiv.innerHTML = '';
      const categories = [...new Set(foodDB.map(food => food.category))];
      categories.forEach(category => {
        const categoryFoods = foods.filter(food => food.category === category);
        if (categoryFoods.length > 0) {
          const button = document.createElement('button');
          button.className = 'accordion-button';
          button.innerHTML = `<i class="fas fa-chevron-down"></i> ${category}`;
          const content = document.createElement('div');
          content.className = 'accordion-content';
          const table = document.createElement('table');
          table.innerHTML = `
            <thead>
              <tr>
                <th>تصویر</th>
                <th>نام</th>
                <th>سدیم (گرم)</th>
                <th>پتاسیم (گرم)</th>
                <th>فسفر (گرم)</th>
                <th>پروتئین (گرم)</th>
                <th>آب (میلی‌لیتر)</th>
                <th>کالری (kcal)</th>
                <th>کربوهیدرات (گرم)</th>
                <th>چربی (گرم)</th>
                <th>تأثیر بر قند خون</th>
                <th>هشدارها</th>
                <th>عملیات</th>
              </tr>
            </thead>
            <tbody>
              ${categoryFoods.map((food, index) => {
                const warnings = [];
                if (food.restrictions) {
                  if (food.restrictions.sodium === 'high') warnings.push('سدیم بالا');
                  if (food.restrictions.potassium === 'high') warnings.push('پتاسیم بالا');
                  if (food.restrictions.phosphorus === 'high') warnings.push('فسفر بالا');
                  if (food.restrictions.bloodSugar === 'high') warnings.push('قند خون بالا');
                }
                const warningText = warnings.length > 0 ? `⚠️ ${warnings.join('، ')}` : '';
                return `
                  <tr ${warnings.length > 0 ? 'style="background-color: #ffe6e6;"' : ''}>
                    <td><img src="${food.image || ''}" class="food-image" ${!food.image ? 'style="display:none;"' : ''}></td>
                    <td>${food.name}</td>
                    <td>${(food.sodium || 0).toFixed(3)}</td>
                    <td>${(food.potassium || 0).toFixed(3)}</td>
                    <td>${(food.phosphorus || 0).toFixed(3)}</td>
                    <td>${(food.protein || 0).toFixed(2)}</td>
                    <td>${(food.water || 0).toFixed(2)}</td>
                    <td>${(food.kcal || 0).toFixed(2)}</td>
                    <td>${(food.carb || 0).toFixed(2)}</td>
                    <td>${(food.fat || 0).toFixed(2)}</td>
                    <td>${food.bloodSugarImpact || 'نامشخص'}</td>
                    <td>${warningText}</td>
                    <td>
                      <button class="edit-button" onclick="editFood(${foodDB.indexOf(food)})"><i class="fas fa-edit"></i> ویرایش</button>
                      <button class="delete-button" onclick="deleteFood(${foodDB.indexOf(food)})"><i class="fas fa-trash"></i> حذف</button>
                    </td>
                  </tr>
                `;
              }).join('')}
            </tbody>
          `;
          content.appendChild(table);
          foodCategoriesDiv.appendChild(button);
          foodCategoriesDiv.appendChild(content);
        }
      });
      setupAccordion();
    }

    function showAddFoodForm() {
      const form = document.getElementById('addFoodForm');
      form.style.display = 'block';
      document.getElementById('foodIndex').value = '';
      document.getElementById('foodName').value = '';
      document.getElementById('foodCategory').value = 'گوشت';
      document.getElementById('foodImage').value = '';
      document.getElementById('foodSodium').value = '';
      document.getElementById('foodPotassium').value = '';
      document.getElementById('foodPhosphorus').value = '';
      document.getElementById('foodProtein').value = '';
      document.getElementById('foodWater').value = '';
      document.getElementById('foodKcal').value = '';
      document.getElementById('foodCarb').value = '';
      document.getElementById('foodFat').value = '';
    }

    function editFood(index) {
      const food = foodDB[index];
      document.getElementById('addFoodForm').style.display = 'block';
      document.getElementById('foodIndex').value = index;
      document.getElementById('foodName').value = food.name;
      document.getElementById('foodCategory').value = food.category;
      document.getElementById('foodSodium').value = food.sodium;
      document.getElementById('foodPotassium').value = food.potassium;
      document.getElementById('foodPhosphorus').value = food.phosphorus;
      document.getElementById('foodProtein').value = food.protein;
      document.getElementById('foodWater').value = food.water;
      document.getElementById('foodKcal').value = food.kcal;
      document.getElementById('foodCarb').value = food.carb;
      document.getElementById('foodFat').value = food.fat;
    }

    function addFood(event) {
      event.preventDefault();
      const index = document.getElementById('foodIndex').value;
      const sodium = parseFloat(document.getElementById('foodSodium').value);
      const potassium = parseFloat(document.getElementById('foodPotassium').value);
      const phosphorus = parseFloat(document.getElementById('foodPhosphorus').value);
      const protein = parseFloat(document.getElementById('foodProtein').value);
      const water = parseFloat(document.getElementById('foodWater').value);
      const kcal = parseFloat(document.getElementById('foodKcal').value);
      const carb = parseFloat(document.getElementById('foodCarb').value);
      const fat = parseFloat(document.getElementById('foodFat').value);
      const imageInput = document.getElementById('foodImage');
      const image = imageInput.files && imageInput.files[0] ? URL.createObjectURL(imageInput.files[0]) : '';

      if (isNaN(sodium) || isNaN(potassium) || isNaN(phosphorus) || isNaN(protein) || isNaN(water) || isNaN(kcal) || isNaN(carb) || isNaN(fat)) {
        showError('لطفاً تمام مقادیر را به صورت معتبر وارد کنید.');
        return;
      }

      const newFood = {
        name: document.getElementById('foodName').value,
        category: document.getElementById('foodCategory').value,
        sodium: parseFloat(sodium.toFixed(3)),
        potassium: parseFloat(potassium.toFixed(3)),
        phosphorus: parseFloat(phosphorus.toFixed(3)),
        protein: parseFloat(protein.toFixed(2)),
        water: parseFloat(water.toFixed(2)),
        kcal: parseFloat(kcal.toFixed(2)),
        carb: parseFloat(carb.toFixed(2)),
        fat: parseFloat(fat.toFixed(2)),
        bloodSugarImpact: document.getElementById('foodName').value.includes('bloodsugar') ? 'medium' : 'low',
        restrictions: {},
        image: image
      };

      if (index === '') {
        foodDB.push(newFood);
      } else {
        foodDB[index] = newFood;
      }
      saveData();
      displayFoodDatabase();
      populateFoodSelect();
      populateFoodNutrientSelect();
      document.getElementById('addFoodForm').style.display = 'none';
      document.getElementById('addFoodForm').reset();
    }

    function deleteFood(index) {
      foodDB.splice(index, 1);
      saveData();
      displayFoodDatabase();
      populateFoodSelect();
      populateFoodNutrientSelect();
    }

    function displayFoodNutrients(event) {
      event.preventDefault();
      const foodSelect = document.getElementById('foodNutrientSelect');
      const foodIndex = parseInt(foodSelect.value);

      if (isNaN(foodIndex) || foodIndex < 0 || foodIndex >= foodDB.length) {
        showError('لطفاً یک غذا انتخاب کنید.');
        return;
      }

      const food = foodDB[foodIndex];
      const chartsContainer = document.getElementById('foodNutrientCharts');
      chartsContainer.innerHTML = `
        <div class="chart-wrapper">
          <canvas id="foodSodiumChart"></canvas>
          <span>${food.sodium.toFixed(3)} گرم</span>
        </div>
        <div class="chart-wrapper">
          <canvas id="foodPotassiumChart"></canvas>
          <span>${food.potassium.toFixed(3)} گرم</span>
        </div>
        <div class="chart-wrapper">
          <canvas id="foodPhosphorusChart"></canvas>
          <span>${food.phosphorus.toFixed(3)} گرم</span>
        </div>
        <div class="chart-wrapper">
          <canvas id="foodProteinChart"></canvas>
          <span>${food.protein.toFixed(2)} گرم</span>
        </div>
        <div class="chart-wrapper">
          <canvas id="foodWaterChart"></canvas>
          <span>${food.water.toFixed(2)} میلی‌لیتر</span>
        </div>
      `;

      const nutrients = [
        { id: 'foodSodiumChart', label: 'سدیم', value: food.sodium, max: limits.sodium, color: 'rgba(255, 99, 132, 0.7)' },
        { id: 'foodPotassiumChart', label: 'پتاسیم', value: food.potassium, max: limits.potassium, color: 'rgba(54, 162, 235, 0.7)' },
        { id: 'foodPhosphorusChart', label: 'فسفر', value: food.phosphorus, max: limits.phosphorus, color: 'rgba(255, 206, 86, 0.7)' },
        { id: 'foodProteinChart', label: 'پروتئین', value: food.protein, max: limits.protein, color: 'rgba(75, 192, 192, 0.7)' },
        { id: 'foodWaterChart', label: 'آب', value: food.water, max: limits.water, color: 'rgba(153, 102, 255, 0.7)' },
      ];

      nutrients.forEach(nutrient => {
        if (nutrientCharts[nutrient.id]) {
          nutrientCharts[nutrient.id].destroy();
        }
        const ctx = document.getElementById(nutrient.id).getContext('2d');
        const remaining = Math.max(0, nutrient.max - nutrient.value);
        nutrientCharts[nutrient.id] = new Chart(ctx, {
          type: 'pie',
          data: {
            labels: ['مقدار در 100 گرم', 'باقی‌مانده تا حد مجاز'],
            datasets: [{
              data: [nutrient.value, remaining],
              backgroundColor: [nutrient.color, 'rgba(200, 200, 200, 0.3)'],
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { position: 'top', labels: { font: { size: 10 } } },
              title: { display: true, text: nutrient.label, font: { size: 12 } }
            }
          }
        });
      });
    }

    function saveSettings(event) {
      event.preventDefault();
      const ibw = parseFloat(document.getElementById('ibw').value);
      const urineOutput = parseFloat(document.getElementById('urineOutput').value) || 0;
      const minimumUrineOutput = parseFloat(document.getElementById('minimumUrineOutput').value);

      if (isNaN(ibw) || ibw <= 0) {
        showError('لطفاً وزن ایده‌آل معتبری وارد کنید.');
        return;
      }
      if (isNaN(minimumUrineOutput) || minimumUrineOutput <= 0) {
        showError('لطفاً حداقل مقدار ادرار معتبری وارد کنید.');
        return;
      }

      limits = {
        sodium: parseFloat((2.3 * (ibw / 70)).toFixed(3)),
        potassium: parseFloat((2.5 * (ibw / 70)).toFixed(3)),
        phosphorus: parseFloat((0.9 * (ibw / 70)).toFixed(3)),
        protein: parseFloat((ibw * 1.2).toFixed(2)),
        water: parseFloat((1000 + urineOutput + (ibw * 50)).toFixed(2))
      };

      document.getElementById('sodiumLimit').value = limits.sodium.toFixed(3);
      document.getElementById('potassiumLimit').value = limits.potassium.toFixed(3);
      document.getElementById('phosphorusLimit').value = limits.phosphorus.toFixed(3);
      document.getElementById('proteinLimit').value = limits.protein.toFixed(2);
      document.getElementById('waterLimit').value = limits.water.toFixed(2);

      saveData();
      displayLimits();
      updateDashboard();
      applyFontSize(document.getElementById('fontSize').value);
      showError('تنظیمات با موفقیت ذخیره شد.');
    }

    function displayLimits() {
      document.getElementById('sodiumLimitDisplayMg').textContent = limits.sodium.toFixed(3);
      document.getElementById('potassiumLimitDisplayMg').textContent = limits.potassium.toFixed(3);
      document.getElementById('phosphorusLimitDisplayMg').textContent = limits.phosphorus.toFixed(3);
      document.getElementById('proteinLimitDisplayMg').textContent = limits.protein.toFixed(2);
      document.getElementById('waterLimitDisplayMl').textContent = limits.water.toFixed(2);
      document.getElementById('sodiumLimit').value = limits.sodium.toFixed(3);
      document.getElementById('potassiumLimit').value = limits.potassium.toFixed(3);
      document.getElementById('phosphorusLimit').value = limits.phosphorus.toFixed(3);
      document.getElementById('proteinLimit').value = limits.protein.toFixed(2);
      document.getElementById('waterLimit').value = limits.water.toFixed(2);
      document.getElementById('ibw').value = userData.ibw || '';
      document.getElementById('urineOutput').value = userData.urineOutput || '';
      document.getElementById('minimumUrineOutput').value = userData.minimumUrineOutput || 500;
      document.getElementById('fontSize').value = userData.fontSize || 'large';
    }

    function updateDashboard() {
      const now = new Date().getTime();
      const oneDayInMs = 24 * 60 * 60 * 1000;
      const recentIntakes = intakeHistory.filter(item => {
        return (now - item.timestamp) <= oneDayInMs;
      });

      const totalSodium = parseFloat(recentIntakes.reduce((sum, item) => sum + (item.sodium || 0), 0).toFixed(3));
      const totalPotassium = parseFloat(recentIntakes.reduce((sum, item) => sum + (item.potassium || 0), 0).toFixed(3));
      const totalPhosphorus = parseFloat(recentIntakes.reduce((sum, item) => sum + (item.phosphorus || 0), 0).toFixed(3));
      const totalProtein = parseFloat(recentIntakes.reduce((sum, item) => sum + (item.protein || 0), 0).toFixed(2));
      const totalWater = parseFloat(recentIntakes.reduce((sum, item) => sum + (item.water || 0), 0).toFixed(2));
      const totalKcal = parseFloat(recentIntakes.reduce((sum, item) => sum + (item.kcal || 0), 0).toFixed(2));
      const totalUrine = calculateDailyUrineOutput();

      document.getElementById('totalSodiumMg').textContent = totalSodium.toFixed(3);
      document.getElementById('totalPotassiumMg').textContent = totalPotassium.toFixed(3);
      document.getElementById('totalPhosphorusMg').textContent = totalPhosphorus.toFixed(3);
      document.getElementById('totalProteinMg').textContent = totalProtein.toFixed(2);
      document.getElementById('totalWaterMl').textContent = totalWater.toFixed(2);
      document.getElementById('totalKcal').textContent = totalKcal.toFixed(2);
      document.getElementById('dailyUrineOutput').textContent = totalUrine.toFixed(2);

      const warningsDiv = document.getElementById('warnings');
      warningsDiv.innerHTML = '';

      const nutrients = [
        { id: 'sodiumChart', stickerId: 'sodiumSticker', label: 'سدیم', value: totalSodium, max: limits.sodium },
        { id: 'potassiumChart', stickerId: 'potassiumSticker', label: 'پتاسیم', value: totalPotassium, max: limits.potassium },
        { id: 'phosphorusChart', stickerId: 'phosphorusSticker', label: 'فسفر', value: totalPhosphorus, max: limits.phosphorus },
        { id: 'proteinChart', stickerId: 'proteinSticker', label: 'پروتئین', value: totalProtein, max: limits.protein },
        { id: 'waterChart', stickerId: 'waterSticker', label: 'آب', value: totalWater, max: limits.water }
      ];

      nutrients.forEach(nutrient => {
        const remaining = Math.max(0, nutrient.max - nutrient.value);
        const sticker = document.getElementById(nutrient.stickerId);
        if (nutrient.value > nutrient.max) {
          sticker.textContent = '⚠️';
          const warning = document.createElement('div');
          warning.className = 'warning';
          warning.textContent = `هشدار: مصرف ${nutrient.label} (${nutrient.value.toFixed(nutrient.label === 'آب' ? 2 : 3)}) از حد مجاز (${nutrient.max.toFixed(nutrient.label === 'آب' ? 2 : 3)}) بیشتر است.`;
          warningsDiv.appendChild(warning);
        } else if (nutrient.value > nutrient.max * 0.8) {
          sticker.textContent = '😓';
        } else {
          sticker.textContent = '😊';
        }

        if (charts[nutrient.id]) {
          charts[nutrient.id].destroy();
        }
        const ctx = document.getElementById(nutrient.id).getContext('2d');
        charts[nutrient.id] = new Chart(ctx, {
          type: 'pie',
          data: {
            labels: ['مصرف‌شده', 'باقی‌مانده'],
            datasets: [{
              data: [nutrient.value, remaining],
              backgroundColor: ['rgba(75, 192, 192, 0.7)', 'rgba(200, 200, 200, 0.3)'],
              borderWidth: 1
            }],
          },
          options: {
            responsive: true,
            plugins: {
              legend: { position: 'top', labels: { font: { size: 10 } } },
              title: { display: true, text: nutrient.label, font: { size: 12 } }
            }
          }
        });
      });

      if (totalUrine < userData.minimumUrineOutput) {
        const warning = document.createElement('div');
        warning.className = 'warning';
        warning.textContent = `هشدار: مقدار ادرار روزانه (${totalUrine.toFixed(2)} میلی‌لیتر) کمتر از حداقل مجاز (${userData.minimumUrineOutput.toFixed(2)} میلی‌لیتر) است.`;
        warningsDiv.appendChild(warning);
      }
    }

    function sendSMS() {
      const message = encodeURIComponent('سلام، من از اپلیکیشن تغذیه دیالیزی استفاده می‌کنم و نیاز به مشاوره دارم.');
      const phoneNumber = '+989123456789';
      window.location.href = `sms:${phoneNumber}?body=${message}`;
    }

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').then(registration => {
          console.log('Service Worker registered with scope:', registration.scope);
        }).catch(error => {
          console.error('Service Worker registration failed:', error);
        });
      });
    }
  </script> 
 
</body></html>